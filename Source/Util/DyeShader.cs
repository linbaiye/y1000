using Godot;

namespace y1000.Source.Util;

public class DyeShader
{
    
    private static readonly int[] COLOR_TABLE = {
            0, 0, 16912, 0, 10991, 0, 19880, 0, 19096, 0, 25858, 0, 8787, 0, 29501, 0, 29587, 0, 13316, 0,
            7933, 0, 4228, 0, 31744, 0, 992, 0, 31, 0, 32767, 0, 0, 3, 16912, 3, 10991, 3, 19880, 3,
            19096, 3, 25858, 3, 8787, 3, 29501, 3, 29587, 3, 13316, 3, 7933, 3, 4228, 3, 31744, 3, 992, 3,
            31, 3, 32767, 3, 65535, 3, 65535, 3, 65535, 3, 65535, 3, 65535, 3, 65535, 3, 65535, 3, 65535, 3,
            65535, 3, 65535, 3, 65535, 3, 65535, 3, 0, 3, 0, 3, 0, 3, 0, 3, 26238, 3, 63395, 3,
            8533, 3, 16281, 3, 55316, 3, 61709, 3, 8037, 3, 16297, 3, 6646, 3, 37582, 3, 54560, 3, 16306, 3,
            46124, 3, 48169, 3, 6054, 3, 16313, 3, 29454, 3, 22185, 3, 22094, 3, 16319, 3, 24890, 3, 28302, 3,
            51216, 3, 16322, 3, 16326, 3, 17547, 3, 57876, 3, 16325, 3, 42507, 3, 15465, 3, 63672, 3, 16328, 3,
            20323, 3, 27262, 3, 2946, 3, 16332, 3, 24347, 3, 31521, 3, 6649, 3, 16335, 3, 63095, 3, 25265, 3,
            4562, 3, 16337, 3, 40710, 3, 11989, 3, 37894, 3, 16338, 3, 26113, 3, 37911, 3, 4956, 3, 16340, 3,
            8157, 3, 30123, 3, 36762, 3, 16341, 3, 17823, 3, 12538, 3, 2181, 3, 16343, 3, 43363, 3, 42670, 3,
            32226, 3, 16344, 3, 60810, 3, 17320, 3, 61305, 3, 16345, 3, 23744, 3, 2529, 3, 23824, 3, 16347, 3,
            50270, 3, 39217, 3, 50798, 3, 16348, 3, 63035, 3, 14342, 3, 11101, 3, 16350, 3, 39610, 3, 56312, 3,
            35748, 3, 16351, 3, 65518, 3, 39202, 3, 29575, 3, 16352, 3, 19235, 3, 21531, 3, 7859, 3, 16353, 3,
            26824, 3, 14766, 3, 51003, 3, 16353, 3, 4831, 3, 19677, 3, 27909, 3, 16354, 3, 28725, 3, 64737, 3,
            4087, 3, 16355, 3, 20665, 3, 10528, 3, 45050, 3, 16355, 3, 7638, 3, 9481, 3, 19699, 3, 16356, 3,
            58857, 3, 48099, 3, 59082, 3, 16356, 3, 60576, 3, 13452, 3, 32105, 3, 16357, 3, 11487, 3, 21789, 3,
            4279, 3, 16358, 3, 15309, 3, 26239, 3, 41118, 3, 16358, 3, 65430, 3, 14319, 3, 11528, 3, 16359, 3,
            44975, 3, 8810, 3, 46559, 3, 16359, 3, 38766, 3, 3071, 3, 15118, 3, 16360, 3, 5953, 3, 27413, 3,
            48256, 3, 16360, 3, 25595, 3, 18834, 3, 14882, 3, 16361, 3, 34625, 3, 18419, 3, 46048, 3, 16361, 3,
            10114, 3, 41030, 3, 10663, 3, 16362, 3, 41379, 3, 10510, 3, 39782, 3, 16362, 3, 512, 3, 22549, 3,
            2314, 3, 16363, 3, 28222, 3, 17689, 3, 29315, 3, 16363, 3, 38186, 3, 44143, 3, 55232, 3, 16363, 3,
            48561, 3, 61824, 3, 14514, 3, 16364, 3, 4597, 3, 8500, 3, 38219, 3, 16364, 3, 51059, 3, 62524, 3,
            60794, 3, 16364, 3, 51514, 3, 53581, 3, 16692, 3, 16365, 3, 36166, 3, 53042, 3, 36971, 3, 16365, 3,
            49724, 3, 46796, 3, 56083, 3, 16365, 3, 34533, 3, 1270, 3, 8481, 3, 16366, 3, 57618, 3, 60488, 3,
            25224, 3, 16366, 3, 11738, 3, 22214, 3, 40769, 3, 16366, 3
    };
    

    private const float Max = 31;

    public static ShaderMaterial CreateShaderMaterial(int clrIndex)
    {
        var colorIndex = clrIndex is < 0 or >= 256 ? 0 : clrIndex;
        var color = COLOR_TABLE[colorIndex * 2];
        var add = COLOR_TABLE[colorIndex * 2 + 1];
        var shader = ResourceLoader.Load<Shader>("res://Shaders/Dye.gdshader");
        var shaderMaterial = new ShaderMaterial();
        shaderMaterial.Shader = shader;
        var red = (color >> 10) & 0x1f;
        var green = (color >> 5) & 0x1f;
        var blue = color & 0x1f;
        shaderMaterial.SetShaderParameter("ar", red / Max);
        shaderMaterial.SetShaderParameter("ag", green / Max);
        shaderMaterial.SetShaderParameter("ab", blue / Max);
        shaderMaterial.SetShaderParameter("add", add / Max);
        return shaderMaterial;
    }
}